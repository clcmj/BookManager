# 图书管理系统功能设计

# 数据库设计

用户表

| 字段 | 类型 | 大小 | 说明 |
|------|------|------|------|
| id | INT | - | 主键，自增 |
| username | VARCHAR | 50 | 用户名，唯一 |
| email | VARCHAR | 100 | 邮箱，唯一 |
| password | VARCHAR | 255 | 密码，加密存储 |
| nickname | VARCHAR | 50 | 昵称 |
| avatar | VARCHAR | 255 | 头像URL |
| phone | VARCHAR | 20 | 联系电话 |
| role | VARCHAR | 20 | 用户角色：admin管理员/user普通用户 |
| status | INT | - | 账号状态：1正常/0禁用 |
| created_at | DATETIME | - | 创建时间 |
| updated_at | DATETIME | - | 更新时间 |

图书分类表

| 字段 | 类型 | 大小 | 说明 |
|------|------|------|------|
| id | INT | - | 主键，自增 |
| name | VARCHAR | 50 | 分类名称 |
| parent_id | INT | - | 父分类ID，0表示顶级分类 |
| description | TEXT | - | 分类描述 |
| sort_order | INT | - | 排序序号 |
| status | INT | - | 状态：1启用/0禁用 |
| created_at | DATETIME | - | 创建时间 |
| updated_at | DATETIME | - | 更新时间 |

图书表

| 字段 | 类型 | 大小 | 说明 |
|------|------|------|------|
| id | INT | - | 主键，自增 |
| title | VARCHAR | 200 | 书名 |
| author | VARCHAR | 100 | 作者 |
| publisher | VARCHAR | 100 | 出版社 |
| isbn | VARCHAR | 50 | ISBN编号，唯一 |
| category_id | INT | - | 分类ID，外键关联分类表 |
| cover_image | VARCHAR | 255 | 封面图片URL |
| description | TEXT | - | 图书简介 |
| publish_year | INT | - | 出版年份 |
| total_stock | INT | - | 总库存数量 |
| available_stock | INT | - | 可借阅数量 |
| borrow_count | INT | - | 累计借阅次数 |
| status | INT | - | 状态：1上架/0下架 |
| created_at | DATETIME | - | 创建时间 |
| updated_at | DATETIME | - | 更新时间 |

借阅记录表

| 字段 | 类型 | 大小 | 说明 |
|------|------|------|------|
| id | INT | - | 主键，自增 |
| user_id | INT | - | 用户ID，外键关联用户表 |
| book_id | INT | - | 图书ID，外键关联图书表 |
| borrow_date | DATETIME | - | 借阅时间 |
| expected_return_date | DATETIME | - | 应还时间 |
| actual_return_date | DATETIME | - | 实际归还时间，未归还为NULL |
| borrow_days | INT | - | 借阅天数 |
| status | VARCHAR | 20 | 状态：pending待审核/approved已批准/borrowing借阅中/returned已归还/rejected已拒绝/overdue已逾期 |
| reject_reason | TEXT | - | 拒绝原因 |
| created_at | DATETIME | - | 创建时间 |
| updated_at | DATETIME | - | 更新时间 |

# 用户管理模块

## API设计

用户管理API表

| 端点 | 方法 | 描述 |
|------|------|------|
| /api/auth/register | POST | 用户注册 |
| /api/auth/login | POST | 用户登录 |
| /api/auth/logout | POST | 用户登出 |
| /api/users/profile | GET | 获取个人信息 |
| /api/users/profile | PUT | 更新个人信息 |
| /api/users/password | PUT | 修改密码 |
| /api/users/avatar | POST | 上传头像 |
| /api/admin/users | GET | 管理员获取用户列表 |
| /api/admin/users/{id}/status | PUT | 管理员修改用户状态 |

## 后端设计

1. 用户注册功能：接收用户提交的用户名、邮箱、密码，验证数据格式和唯一性，对密码进行加密处理后存储到数据库，默认角色为普通用户
2. 用户登录功能：验证用户名或邮箱与密码的匹配性，验证成功后生成JWT令牌返回给客户端，记录登录时间
3. 用户登出功能：使当前用户的令牌失效，清除登录状态
4. 获取个人信息功能：根据当前登录用户的令牌获取用户详细信息，不返回密码字段
5. 更新个人信息功能：允许用户修改昵称、联系电话等非敏感信息，验证数据格式的合法性
6. 修改密码功能：验证原密码的正确性，对新密码进行强度检查，加密后更新到数据库
7. 上传头像功能：接收图片文件，验证文件类型和大小，保存到服务器并返回访问URL
8. 用户列表管理功能：管理员可以查询所有用户信息，支持分页和关键词搜索
9. 用户状态管理功能：管理员可以启用或禁用用户账号，控制用户的登录权限

## 管理端功能设计

1. 用户列表展示：以表格形式展示所有用户信息，包括用户名、邮箱、角色、状态、注册时间等字段
2. 用户搜索功能：提供搜索框支持按用户名或邮箱搜索用户
3. 用户状态切换：提供启用或禁用按钮，可以控制用户账号的可用状态
4. 分页导航：支持分页浏览用户列表，显示总数和当前页码

## 用户端功能设计

1. 注册页面：提供注册表单，包含用户名、邮箱、密码、确认密码输入框，实时验证输入格式
2. 登录页面：提供登录表单，支持用户名或邮箱登录，记住登录状态选项
3. 个人中心页面：展示用户的个人信息，包括头像、用户名、昵称、邮箱、联系电话
4. 信息编辑功能：提供编辑表单修改昵称和联系电话，保存后实时更新显示
5. 头像上传功能：支持点击头像上传新图片，预览后确认更换
6. 密码修改功能：提供独立的密码修改表单，需要输入原密码、新密码和确认密码

# 图书管理模块

## API设计

图书管理API表

| 端点 | 方法 | 描述 |
|------|------|------|
| /api/books | GET | 获取图书列表 |
| /api/books/{id} | GET | 获取图书详情 |
| /api/admin/books | POST | 添加图书 |
| /api/admin/books/{id} | PUT | 更新图书信息 |
| /api/admin/books/{id} | DELETE | 删除图书 |
| /api/admin/books/batch | DELETE | 批量删除图书 |
| /api/admin/books/{id}/cover | POST | 上传图书封面 |
| /api/books/hot | GET | 获取热门图书 |
| /api/books/new | GET | 获取新书推荐 |

## 后端设计

1. 图书列表查询功能：支持分页查询所有上架图书，返回图书基本信息和库存状态
2. 图书详情查询功能：根据图书ID获取完整的图书信息，包括分类、作者、简介、库存等
3. 图书新增功能：管理员提交图书信息，验证ISBN的唯一性，初始化库存数量，保存到数据库
4. 图书更新功能：管理员修改图书信息，更新数据库记录，记录更新时间
5. 图书删除功能：检查图书是否有未归还的借阅记录，如果没有则允许删除
6. 批量删除功能：接收多个图书ID，循环检查并删除符合条件的图书
7. 封面上传功能：接收图书封面图片，验证格式和大小，保存后更新图书记录
8. 热门图书统计功能：根据借阅次数排序，返回借阅量最高的图书列表
9. 新书推荐功能：按创建时间倒序查询最新入库的图书

## 管理端功能设计

1. 图书列表管理页面：表格展示所有图书，显示书名、作者、分类、ISBN、库存、状态等信息
2. 图书搜索功能：支持按书名、作者、ISBN搜索图书
3. 添加图书功能：打开添加表单弹窗，填写图书完整信息，选择分类，上传封面
4. 编辑图书功能：点击编辑按钮弹出表单，预填充现有信息，支持修改所有字段
5. 删除图书功能：提供单个删除按钮，删除前弹窗确认
6. 批量删除功能：支持勾选多条记录，点击批量删除按钮统一删除
7. 图书上下架管理：提供状态切换按钮，控制图书是否对用户可见
8. 分页和排序：支持分页浏览和按不同字段排序

## 用户端功能设计

1. 首页图书展示：以卡片形式展示图书列表，显示封面、书名、作者、库存状态
2. 图书详情页面：点击图书卡片进入详情页，展示完整的图书信息和借阅按钮
3. 热门图书板块：在首页单独展示热门图书排行，吸引用户关注
4. 新书推荐板块：在首页展示最新上架的图书，便于用户发现新内容
5. 图书分页浏览：提供分页控件，支持翻页查看更多图书
6. 库存状态显示：直观显示图书的可借数量，无库存时禁用借阅按钮

# 图书分类模块

## API设计

分类管理API表

| 端点 | 方法 | 描述 |
|------|------|------|
| /api/categories | GET | 获取分类列表 |
| /api/categories/tree | GET | 获取分类树形结构 |
| /api/admin/categories | POST | 添加分类 |
| /api/admin/categories/{id} | PUT | 更新分类 |
| /api/admin/categories/{id} | DELETE | 删除分类 |
| /api/categories/{id}/books | GET | 获取分类下的图书 |

## 后端设计

1. 分类列表查询功能：返回所有启用状态的分类，按排序序号排列
2. 分类树形结构查询功能：将分类组织成树形结构返回，方便前端展示层级关系
3. 分类新增功能：管理员创建新分类，可以指定父分类构建层级关系，设置排序序号
4. 分类更新功能：修改分类名称、描述、排序序号等信息，不允许将分类设置为自己的子分类
5. 分类删除功能：检查该分类下是否有子分类或关联图书，如果有则不允许删除，否则执行删除
6. 分类图书查询功能：根据分类ID查询该分类下的所有图书，支持分页

## 管理端功能设计

1. 分类列表页面：以树形表格展示分类层级结构，显示分类名称、描述、排序、状态
2. 添加分类功能：提供添加表单，可以选择父分类创建子分类，填写名称和描述
3. 编辑分类功能：点击编辑按钮弹出表单，修改分类信息
4. 删除分类功能：提供删除按钮，删除前检查约束条件并提示
5. 拖拽排序功能：支持拖拽调整分类的显示顺序
6. 分类启用禁用：提供状态切换功能，控制分类是否在用户端显示

## 用户端功能设计

1. 分类导航菜单：在首页展示分类树形菜单，支持一级和二级分类导航
2. 分类筛选功能：点击分类后筛选显示该分类下的所有图书
3. 面包屑导航：在分类页面显示当前位置的分类路径
4. 分类图书数量显示：在分类菜单中显示每个分类下的图书数量

# 借阅管理模块

## API设计

借阅管理API表

| 端点 | 方法 | 描述 |
|------|------|------|
| /api/borrows | POST | 提交借阅申请 |
| /api/borrows/my | GET | 获取个人借阅记录 |
| /api/borrows/{id}/return | PUT | 归还图书 |
| /api/admin/borrows | GET | 管理员获取所有借阅记录 |
| /api/admin/borrows/{id}/approve | PUT | 审核通过借阅申请 |
| /api/admin/borrows/{id}/reject | PUT | 拒绝借阅申请 |
| /api/borrows/overdue | GET | 获取逾期记录 |
| /api/borrows/statistics | GET | 获取借阅统计数据 |

## 后端设计

1. 借阅申请功能：用户提交借阅申请，检查图书库存，检查用户是否有逾期未还图书，创建待审核的借阅记录
2. 个人借阅记录查询功能：根据用户ID查询该用户的所有借阅记录，支持按状态筛选
3. 图书归还功能：用户提交归还申请，更新借阅记录的实际归还时间，增加图书可借数量，判断是否逾期
4. 借阅记录列表查询功能：管理员查询所有借阅记录，支持按用户、图书、状态筛选，分页展示
5. 审核通过功能：管理员审核借阅申请，更新状态为借阅中，减少图书可借数量，增加借阅次数统计
6. 审核拒绝功能：管理员拒绝借阅申请，填写拒绝原因，更新记录状态
7. 逾期记录查询功能：查询所有已逾期的借阅记录，计算逾期天数
8. 借阅统计功能：统计用户的总借阅次数、当前在借数量、阅读偏好分类等数据

## 管理端功能设计

1. 借阅记录列表页面：表格展示所有借阅记录，包括用户、图书、借阅时间、应还时间、状态
2. 待审核列表筛选：快速筛选出待审核的借阅申请，突出显示
3. 审核操作功能：提供通过和拒绝按钮，拒绝时弹窗填写原因
4. 逾期记录标识：用醒目颜色标识逾期记录，显示逾期天数
5. 借阅记录搜索：支持按用户名、图书名搜索借阅记录
6. 借阅统计报表：以图表形式展示借阅趋势、热门图书等统计数据

## 用户端功能设计

1. 借阅申请提交：在图书详情页点击借阅按钮，选择借阅天数，提交申请
2. 我的借阅页面：展示个人所有借阅记录，包含当前在借和历史记录
3. 借阅状态标识：用不同颜色和图标标识待审核、借阅中、已归还、已拒绝、已逾期状态
4. 归还操作功能：在借阅中的记录提供归还按钮，确认后提交归还
5. 逾期提醒：醒目提示即将到期和已逾期的图书，显示剩余天数或逾期天数
6. 拒绝原因查看：如果申请被拒绝，显示管理员填写的拒绝原因
7. 个人阅读统计：展示个人借阅总数、偏好分类、阅读时长等统计图表

# 搜索与推荐模块

## API设计

搜索推荐API表

| 端点 | 方法 | 描述 |
|------|------|------|
| /api/search/books | GET | 搜索图书 |
| /api/search/advanced | GET | 高级筛选 |
| /api/recommendations/hot | GET | 热门推荐 |
| /api/recommendations/new | GET | 新书推荐 |
| /api/recommendations/personal | GET | 个性化推荐 |

## 后端设计

1. 图书搜索功能：接收关键词参数，在书名、作者、ISBN字段中进行模糊匹配查询，返回匹配结果
2. 高级筛选功能：支持多条件组合查询，包括分类、出版年份、库存状态等条件，构建动态查询语句
3. 热门推荐功能：按借阅次数降序排序，返回借阅量最高的图书列表，可配置返回数量
4. 新书推荐功能：按创建时间降序排序，返回最新入库的图书列表
5. 个性化推荐功能：根据用户的借阅历史分析偏好分类，推荐该分类下的高评分图书

## 管理端功能设计

1. 搜索功能集成：在图书管理页面集成搜索框，实时搜索图书
2. 高级筛选面板：提供下拉选择和日期选择器，组合多个筛选条件
3. 热门图书统计：以排行榜形式展示借阅量最高的图书，显示借阅次数

## 用户端功能设计

1. 首页搜索框：在页面顶部提供搜索框，输入关键词后跳转到搜索结果页
2. 搜索结果展示：以列表或卡片形式展示搜索到的图书，显示匹配度排序
3. 搜索历史记录：记录用户的搜索关键词，提供快速再次搜索功能
4. 高级筛选面板：在搜索结果页提供侧边栏，展示分类、年份等筛选项
5. 筛选条件标签：已选择的筛选条件以标签形式展示，可点击取消
6. 热门图书轮播：在首页以轮播图或卡片形式展示热门图书，吸引用户点击
7. 新书推荐区域：在首页单独展示新书推荐板块，突出最新内容
8. 个性化推荐：根据用户的阅读偏好，在首页展示为你推荐板块
9. 阅读统计可视化：在个人中心以图表形式展示借阅数量、偏好分类占比、阅读趋势等统计数据

